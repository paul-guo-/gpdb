<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic
  PUBLIC "-//OASIS//DTD DITA Composite//EN" "ditabase.dtd">
<topic id="topic1">
  <title id="pa137116">restore_data_subset</title>
  <body>
    <p>Plugin command to stream a filtered dataset from the remote storage
      system to <codeph>stdout</codeph> .</p>
    <section id="section2">
      <title>Synopsis</title>
      <codeblock><varname>plugin_executable</varname> <b>restore_data_subset</b> <varname>plugin_config_file</varname> <varname>data_filenamekey</varname> <varname>offsets_file</varname></codeblock>
    </section>
    <section id="section3">
      <title>Description</title>
      <p><codeph>gprestore</codeph> invokes a plugin's <codeph>restore_data</codeph>
        or <codeph>restore_data_subset</codeph> command to restore a backup.
        <codeph>gprestore</codeph> invokes the more performant <codeph>restore_data_subset</codeph>
        plugin command on each segment host to perform a filtered restore operation
        when all of the following conditions hold:</p>
        <ul>
          <li>The backup is an uncompressed, single-data-file backup (the
            <codeph>gpbackup</codeph> command was invoked with the
            <codeph>--no-compression</codeph> and <codeph>--single-data-file</codeph>
            flags).</li>
          <li>Filtering options (<codeph>--include-table</codeph>,
            <codeph>--exclude-table</codeph>, <codeph>--include-table-file</codeph>,
            or <codeph>&#x2011;&#x2011;exclude-table-file</codeph>) are specified on the 
            <codeph>gprestore</codeph> command line.</li>
          <li>The <varname>plugin_config_file</varname> specifies the
            <codeph>restore_subset: "on"</codeph> property setting.</li>
        </ul>
      <p><codeph>gprestore</codeph> invokes the <codeph>restore_data_subset</codeph> 
        plugin command with an <varname>offsets_file</varname> that it automatically
        generates based on the filters specified. The <codeph>restore_data_subset</codeph>
        implementation should extract the start and end byte offsets for each relation
        specified in <varname>offsets_file</varname>, use this information to
        selectively read from a potentially large data file named or mapped to
        <codeph>data_filenamekey</codeph> on the remote storage system, and write
        the contents to <codeph>stdout</codeph>.</p>
    </section>
    <section id="section4"><title>Arguments</title><parml>
        <plentry>
          <pt><varname>plugin_config_file</varname></pt>
          <pd>The absolute path to the plugin configuration YAML file. This file
            must specify the <codeph>restore_subset: "on"</codeph> property
            setting.</pd>
        </plentry>
        <plentry>
          <pt><varname>data_filenamekey</varname></pt>
          <pd>The mapping key to a backup file on the remote storage system.
            <varname>data_filenamekey</varname> is the same key provided to the
            <codeph>backup_data</codeph> command.</pd>
        </plentry>
        <plentry>
          <pt><varname>offsets_file</varname></pt>
          <pd>The absolute path to the relation offsets file generated by
            <codeph>gprestore</codeph>. This file specifies the number of
            relations, and the start and end byte offsets for each relation, that
            the plugin should restore. <codeph>gprestore</codeph> specifies this
            information on a single line in the file. For example, if the file
            contents specified <codeph>2 1001 2007 4500 6000</codeph>, the
            plugin restores two relations; relation 1 with start offset 1001 and
            end offset 2007, and relation 2 with start offset 4500 and end offset
            6000.</pd>
        </plentry>
        </parml>
    </section>
    <section id="section5"><title>Exit Code</title>
      <p>The <codeph>restore_data_subset</codeph> command must exit with a value
        of 0 on success, non-zero if an error occurs. In the case of a non-zero
        exit code, <codeph>gprestore</codeph> displays the contents of
        <codeph>stderr</codeph> to the user.</p>
    </section>
    <section id="section6"><title>See Also</title>
      <p><xref href="restore_data.xml"></xref></p>
    </section>
  </body>
</topic>
